<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:th="http://www.thymeleaf.org" lang="zh-CN">

<div class="dbsyncer-form-container">
    <div class="card-header flex-between">
        <h3 class="card-title">添加用户</h3>
        <div class="form-actions">
            <button id="userSubmitBtn" type="button" class="btn btn-primary">
                <i class="fa fa-save"></i> 保存
            </button>
            <button id="userBackBtn" type="button" class="btn btn-secondary">
                <i class="fa fa-reply"></i> 返回
            </button>
        </div>
    </div>
    <div class="card-body">
        <form id="userAddForm" method="post">
            <div class="form-grid-1">
                <!-- 账号 -->
                <div class="form-item">
                    <label class="form-label">账号<strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input class="form-control" name="username" type="text" maxlength="50" required dbsyncer-valid="require" placeholder="请输入账号"/>
                    </div>
                </div>

                <!-- 昵称 -->
                <div class="form-item">
                    <label class="form-label">昵称<strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input class="form-control" name="nickname" type="text" maxlength="50" required dbsyncer-valid="require" placeholder="请输入昵称"/>
                    </div>
                </div>

                <!-- 密码 -->
                <div class="form-item">
                    <label class="form-label">密码<strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input class="form-control" name="password" type="password" maxlength="64" required dbsyncer-valid="require" placeholder="请输入密码"/>
                    </div>
                </div>

                <!-- 邮箱 -->
                <div class="form-item">
                    <label class="form-label">邮箱
                        <i class="fa fa-question-circle text-tertiary" aria-hidden="true" title="支持多个邮箱，用逗号分隔"></i>
                    </label>
                    <div class="form-control-area">
                        <input type="text" class="form-control" name="email" dbsyncer-valid="false" data-role="tagsinput" placeholder="请输入邮箱地址"/>
                        <div class="form-help">支持多个邮箱，按 Enter 键添加</div>
                    </div>
                </div>

                <!-- 手机 -->
                <div class="form-item">
                    <label class="form-label">手机</label>
                    <div class="form-control-area">
                        <input type="tel" class="form-control" dbsyncer-valid="false" maxlength="13" name="phone" placeholder="请输入手机号码"/>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
  // 绑定多值输入框事件
  initMultipleInputTags();
  
  // 跳转用户管理
  function backUserIndexPage() {
    doLoader("/user?refresh=" + new Date().getTime());
  }

  //保存
  $("#userSubmitBtn").on('click', function () {
    const $form = $("#userAddForm");
    const $btn = $(this);
    
    // 防止重复提交
    if ($btn.prop('disabled')) {
        return;
    }
    
    if ($form.formValidate() == true) {
      $btn.prop('disabled', true);
      const originalText = $btn.html();
      $btn.html('<i class="fa fa-spinner fa-spin"></i> 保存中...');
      
      const data = $form.serializeJson();
      doPoster("/user/add", data, function (response) {
        $btn.prop('disabled', false);
        $btn.html(originalText);
        
        if (response.success == true) {
          bootGrowl("新增用户成功！", "success");
          setTimeout(function() {
            backUserIndexPage();
          }, 500);
        } else {
          bootGrowl(response.resultValue || "新增失败", "danger");
        }
      });
    }
  });

  //返回
  $("#userBackBtn").on('click', function () {
    backUserIndexPage();
  });
</script>
</html>