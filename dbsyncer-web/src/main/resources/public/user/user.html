<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" lang="zh-CN">

<div class="form-container">
    <div class="card-header">
        <h3 class="card-title text-center">用户管理</h3>
        <!-- 管理员操作区域 -->
        <div class="form-actions" th:if="${currentUser?.roleCode eq 'admin'}">
            <button id="addUserBtn" type="button" class="btn btn-primary">
                <i class="fa fa-plus"></i> 添加用户
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-wrapper">
            <table class="table">
                <thead>
                <tr>
                    <th>用户</th>
                    <th>角色</th>
                    <th>邮箱</th>
                    <th>手机</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="userList">
                <tr th:if="${users == null or users.isEmpty()}">
                    <td colspan="5" class="text-center text-tertiary py-8">暂无用户数据</td>
                </tr>
                <tr th:each="u : ${users}">
                    <td>
                        <div class="flex items-center gap-2">
                            <div th:classappend="${u?.roleCode eq 'admin'} ? 'user-avatar' : ''">
                                <i class="fa fa-user-circle"></i>
                            </div>
                            <div>
                                <div class="font-medium text-primary" th:text="${u?.username}"></div>
                                <div class="text-xs text-tertiary" th:text="${u?.nickname}"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge"
                              th:classappend="${u?.roleCode eq 'admin'} ? 'badge-success' : 'badge-primary'"
                              th:text="${u?.roleName}"></span>
                    </td>
                    <td>
                        <div class="flex flex-wrap gap-1">
                            <span th:each="m : ${#strings.listSplit(u?.email, ',')}"
                                  class="badge badge-success"
                                  th:text="${m}"></span>
                        </div>
                    </td>
                    <td>
                        <span class="text-sm text-secondary" th:text="${u?.phone ?: '-'}"></span>
                    </td>
                    <td>
                        <div class="btn-group-sm">
                            <!-- 管理员或本人可以修改 -->
                            <button th:if="${currentUser?.roleCode eq 'admin' or currentUser?.username eq u?.username}"
                                    type="button"
                                    th:data-username="${u?.username}"
                                    class="btn btn-sm btn-info editUserBtn">
                                <i class="fa fa-pencil"></i> 修改
                            </button>
                            <!-- 仅管理员可以删除其他用户 -->
                            <button th:if="${currentUser?.roleCode eq 'admin' and currentUser?.username != u?.username}"
                                    type="button"
                                    th:data-username="${u?.username}"
                                    class="btn btn-sm btn-danger removeUserBtn">
                                <i class="fa fa-trash"></i> 删除
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script th:src="@{/js/user/index.js}"></script>
</html>