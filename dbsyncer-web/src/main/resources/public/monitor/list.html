<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" lang="zh-CN">

<!-- 图表和任务列表 -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-5">
    <!-- 同步趋势图表 -->
    <div class="lg:col-span-2">
        <!-- 顶部：图表区域 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <!-- TPS图表 -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title text-center">执行器TPS</h3>
                </div>
                <div class="card-body">
                    <canvas id="tpsChart" height="200"></canvas>
                </div>
            </div>

            <!-- 堆积数据 & 持久化 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title text-center">堆积数据</h3>
                    </div>
                    <div class="card-body flex items-center justify-center">
                        <canvas id="queueChart" height="200"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title text-center">持久化</h3>
                    </div>
                    <div class="card-body flex items-center justify-center">
                        <canvas id="storageChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 下部：CPU & 内存 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title text-center">CPU(%)</h3>
                </div>
                <div class="card-body">
                    <canvas id="cpuChart" height="200"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title text-center">内存(MB)</h3>
                </div>
                <div class="card-body">
                    <canvas id="memoryChart" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 右侧：系统状态 -->
    <div class="container-no-bg">
        <!-- CPU使用率 -->
        <div class="progress-card mb-3">
            <div class="progress-header">
                <span class="progress-title">CPU使用率</span>
                <span class="progress-value" id="cpuPercentValue">68%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="cpuProgressBar" style="width: 68%"></div>
            </div>
            <div class="progress-detail">
                <span>核心数 <strong id="cpuCores">8</strong></span>
                <span>用户态 <strong id="cpuUser">45%</strong></span>
                <span>系统态 <strong id="cpuSystem">23%</strong></span>
            </div>
        </div>

        <!-- 内存使用率 -->
        <div class="progress-card mb-3">
            <div class="progress-header">
                <span class="progress-title">内存使用率</span>
                <span class="progress-value progress-value-warning" id="memoryPercentValue">72%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill warning" id="memoryProgressBar" style="width: 72%"></div>
            </div>
            <div class="progress-detail">
                <span>总内存 <strong id="memoryTotal">32 GB</strong></span>
                <span>已使用 <strong id="memoryUsed">23 GB</strong></span>
            </div>
        </div>

        <!-- 磁盘使用率 -->
        <div class="progress-card mb-3">
            <div class="progress-header">
                <span class="progress-title">磁盘使用率</span>
                <span class="progress-value progress-value-success" id="diskPercentValue">35%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="diskProgressBar" style="width: 35%"></div>
            </div>
            <div class="progress-detail">
                <span>总容量 <strong id="diskTotal">1.2 TB</strong></span>
                <span>已使用 <strong id="diskUsed">420 GB</strong></span>
            </div>
        </div>

        <!-- 应用状态 -->
        <div class="mb-3">
            <table class="table">
                <tbody>
                <tr>
                    <td>[应用线程]</td>
                    <td>活跃:48 峰值:55</td>
                </tr>
                <tr>
                    <td>[调度线程池]</td>
                    <td>堆积:11/1000 线程:0/16 完成:0</td>
                </tr>
                <tr>
                    <td>[GC]</td>
                    <td>2次，耗时:0.14秒，最长:0秒</td>
                </tr>
                <tr>
                    <td>[通用执行器]</td>
                    <td>堆积:0/50000 线程:0/16 完成:3</td>
                </tr>
                <tr>
                    <td>[持久化执行器]</td>
                    <td>堆积:0/50000 线程:0/8 完成:0</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 查询数据 -->
<div class="form-container mb-4">
    <div class="card-header">
        <div class="grid grid-cols-12 items-center">
            <div class="lg:col-span-3">
                <select id="searchMetaData" class="form-control">
                    <option th:each="m,s:${meta}" th:value="${m?.id}" th:text="${m?.mappingName} +' (' + ${m?.model} +')'" th:selected="${m?.id eq metaId}"/>
                </select>
            </div>
            <div class="lg:col-span-3">
                <select id="searchDataStatus" class="form-control">
                    <option value="-1" selected="selected">无</option>
                    <option th:value="${c?.value}" th:text="${c?.message}" th:each="c,state : ${storageDataStatus}" th:selected="${c?.value eq dataStatus}"/>
                </select>
            </div>
            <div id="searchData" class="lg:col-span-3 search-wrapper">
                <i class="fa fa-search search-icon"></i>
                <input id="searchDataKeyword" class="search-input" type="text" maxlength="32" placeholder="搜索异常关键字">
                <span class="search-clear" title="清除">
                    <i class="fa fa-times"></i>
                </span>
            </div>
            <div class="lg:col-span-3 flex items-center justify-end">
                <button id="clearDataBtn" th:metaId="${metaId}" type="button" class="btn btn-outline">
                    清空数据
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
            <tr>
                <th></th>
                <th>目标表</th>
                <th>事件</th>
                <th>结果</th>
                <th>异常</th>
                <th>时间</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody id="dataList">
            <tr th:each="d,s : ${pagingData?.data}">
                <td class="text-center text-tertiary" th:text="${s.index}+1" />
                <td class="font-medium" th:text="${d?.targetTableName}" />
                <td th:text="${d?.event}" />
                <td>
                    <span th:if="${d?.success == 1}" class="badge badge-success">成功</span>
                    <span th:if="${d?.success == 0}" class="badge badge-warning">失败</span>
                </td>
                <td class="text-ellipsis" style="max-width: 300px;">
                    <a href="javascript:;" class="text-secondary hover-underline queryError" th:text="${d?.error}"></a>
                </td>
                <td class="text-sm text-secondary" th:text="${#dates.format(d?.createTime, 'yyyy-MM-dd HH:mm:ss')}" />
                <td>
                    <div class="flex gap-2">
                        <a th:json="${d?.json}" href="javascript:;" class="btn btn-sm btn-info queryData">
                            <i class="fa fa-eye"></i> 查看数据
                        </a>
                        <a th:if="${d?.success == 0}" th:id="${d?.id}" href="javascript:;" class="btn btn-sm btn-warning retryData">
                            <i class="fa fa-refresh"></i> 重试
                        </a>
                    </div>
                    <div class="hidden" th:text="${d?.json}"></div>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- 分页信息 -->
        <div class="p-5 border-t border-gray-100 flex items-center justify-between">
            <p class="text-sm text-gray-500">共 <span class="totalCount" th:text="${pagingData?.total}">0</span> 条，第 <span class="currentPage">1</span> / <span class="totalPages">1</span> 页</p>
            <div class="flex items-center gap-2">
                <button class="pagination-btn" disabled>
                    <i class="fa fa-angle-left"></i>
                </button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">
                    <i class="fa fa-angle-right"></i>
                </button>
            </div>
        </div>

    </div>
</div>

<div class="grid grid-cols-2">
    <!-- 查询执行器任务 -->
    <div class="form-container">
        <div class="card-header">
            <!-- 表格工具栏 -->
            <div class="grid grid-cols-6 items-center">
                <div id="searchTableActuator" class="lg:col-span-3 search-wrapper">
                    <i class="fa fa-search search-icon"></i>
                    <input id="searchActuatorKeyword" class="search-input" type="text" maxlength="32" placeholder="搜索驱动或表关键字" />
                    <span class="search-clear" title="清除">
                        <i class="fa fa-times"></i>
                    </span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <table class="table">
                <thead>
                <tr>
                    <th></th>
                    <th>[驱动]数据源表</th>
                    <th>结果</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>1</td>
                    <td>[阿里云同步]xhtb_user</td>
                    <td>堆积:8907/10000 线程:1/1 完成:999</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>[阿里云同步]xhtb_user_order</td>
                    <td>堆积:5677/10000 线程:1/1 完成:111</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>[阿里云同步]xhtb_task</td>
                    <td>堆积:0/10000 线程:0/1 完成:0</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>[阿里云同步]xhtb_task1</td>
                    <td>堆积:0/10000 线程:0/1 完成:0</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>[阿里云同步]xhtb_task2</td>
                    <td>堆积:0/10000 线程:0/1 完成:0</td>
                </tr>
                </tbody>
            </table>

            <!-- 分页信息 -->
            <div class="p-5 border-t border-gray-100 flex items-center justify-between">
                <p class="text-sm text-gray-500">共 <span class="totalCount" th:text="${pagingTask?.total}">0</span> 条，第 <span class="currentPage">1</span> / <span class="totalPages">1</span> 页</p>
                <div class="flex items-center gap-2">
                    <button class="pagination-btn" disabled>
                        <i class="fa fa-angle-left"></i>
                    </button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">
                        <i class="fa fa-angle-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 查询日志 -->
    <div class="form-container">
        <div class="card-header">
            <!-- 表格工具栏 -->
            <div class="grid grid-cols-6 items-center">
                <div id="searchLog" class="lg:col-span-3 search-wrapper">
                    <i class="fa fa-search search-icon"></i>
                    <input id="searchLogKeyword" class="search-input" type="text" maxlength="32" placeholder="搜索日志关键字" />
                    <span class="search-clear" title="清除">
                        <i class="fa fa-times"></i>
                    </span>
                </div>
                <div class="lg:col-span-3 flex items-center justify-end">
                    <button id="clearLogBtn" type="button" class="btn btn-outline">
                        清空日志
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body">
            <table class="table">
                <thead>
                <tr>
                    <th></th>
                    <th>日志</th>
                    <th>时间</th>
                </tr>
                </thead>
                <tbody id="logList">
                <tr th:each="l,s : ${pagingLog?.data}">
                    <td th:text="${s.index}+1"></td>
                    <td th:text="${l?.json}"></td>
                    <td th:text="${#dates.format(l?.createTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                </tr>
                </tbody>
            </table>

            <!-- 分页信息 -->
            <div class="p-5 border-t border-gray-100 flex items-center justify-between">
                <p class="text-sm text-gray-500">共 <span class="totalCount" th:text="${pagingLog?.total}">0</span> 条，第 <span class="currentPage">1</span> / <span class="totalPages">1</span> 页</p>
                <div class="flex items-center gap-2">
                    <button class="pagination-btn" disabled>
                        <i class="fa fa-angle-left"></i>
                    </button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">
                        <i class="fa fa-angle-right"></i>
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

<script th:src="@{/js/monitor/index.js}"></script>
</html>