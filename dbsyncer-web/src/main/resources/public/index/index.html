<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="zh-CN">

<!-- ProjectGroup Connector Mapping -->
<div class="container-fluid">
    <div class="row">
        <form class="form-horizontal" role="form" method="post">

            <!-- 分组管理竖排显示 -->
            <div class="col-md-3">
                <!-- 分组管理竖排显示 -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title" style="display: inline-block;">分组管理</h3>
                        <button type="button" style="display: inline-block;margin-left:24px" class="btn btn-default "
                            id="addProjectGroupBtn">
                            <span class="fa fa-plus"></span>添加分组([[${projectGroups?.size()} ?: 0]])
                        </button>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <div class="btn-group-vertical" style="width: 100%;">
                                <button type="button" class="btn btn-default btn-block text-left"
                                    th:classappend="${#strings.isEmpty(projectGroupId)} ? 'active'"
                                    th:onclick="groupShow('')"
                                    style="padding-left: 30px; position: relative;">
                                    <img th:src="@{/img/File.png}" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px;" />
                                    <span style="vertical-align: middle;">&nbsp;★&nbsp;未分配</span>
                                </button>
                                <div th:each="g,s:${projectGroups}" class="btn-group btn-block"
                                    style="display: inline-block;">
                                    <button type="button" class="btn btn-default btn-block text-left"
                                        th:classappend="${g?.id eq projectGroupId} ? 'active'"
                                        th:attr="onclick='groupShow(\'' + ${g?.id} + '\')'"
                                        style="width: calc(100% - 40px); display: inline-block; float: left; border-top-right-radius: 0; border-bottom-right-radius: 0; padding-left: 30px; position: relative;">
                                        <img th:src="@{/img/File.png}" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px;" />
                                        <span style="vertical-align: middle;">&nbsp;★&nbsp;<span th:text="${g?.name}"></span></span>
                                    </button>
                                    <div style="display: inline-block; width: 40px; float: right;">
                                        <div class="dropdown">
                                            <button type="button" class="btn btn-default dropdown-toggle"
                                                data-toggle="dropdown"
                                                style="padding: 6px 8px; margin: 0; width: 40px; border-top-left-radius: 0; border-bottom-left-radius: 0;">
                                                <span class="fa fa-ellipsis-v"></span>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-right">
                                                <li><a href="javascript:;"
                                                        th:attr="onclick='doEditProjectGroup(\'' + ${g?.id} + '\')'">
                                                        <span class="fa fa-pencil"></span> 修改</a></li>
                                                <li><a href="javascript:;"
                                                        th:attr="onclick='doRemoveProjectGroup(\'' + ${g?.id} + '\')'">
                                                        <span class="fa fa-times"></span> 删除</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" th:value="${projectGroupId}" th:name="projectGroup"
                                    id="projectGroup">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <!-- 驱动管理 -->
                <div class="col-md-12">
                    <!-- 驱动开始位置 -->
                    <div class="form-group" th:if="${connectorSize gt 0}">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-primary" id="indexAddMappingBtn">
                                <span class="fa fa-plus"></span>添加驱动([[${mappings?.size()} ?: 0]])
                            </button>
                        </div>
                    </div>

                    <!-- 显示驱动列表 - 表格形式 -->
                    <div class="row" th:if="${mappings?.size() gt 0}">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover table-striped">
                                            <thead>
                                                <tr>
                                                    <th>名称</th>
                                                    <th>运行状态</th>
                                                    <th>起始源</th>
                                                    <th>目标源</th>
                                                    <th>同步类型</th>
                                                    <th>总数</th>
                                                    <th>耗时</th>
                                                    <th>启动时间</th>
                                                    <th>创建时间</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="m,state : ${mappings}" th:id="${m?.id}">
                                                    <!-- 名称 -->
                                                    <td th:text="${m?.name}" th:title="${m?.name}"
                                                        style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                    </td>

                                                    <!-- 运行状态 -->
                                                    <td>
                                                        <span th:if="${m?.meta?.state eq 0}"
                                                            class="label label-info">未运行</span>
                                                        <span th:if="${m?.meta?.state eq 1}"
                                                            class="label label-success">运行中</span>
                                                        <span th:if="${m?.meta?.state eq 2}"
                                                            class="label label-warning">停止中</span>
                                                        <span th:if="${m?.meta?.state eq 3}"
                                                            class="label label-danger">异常</span>
                                                        <!-- 驱动异常提示 -->
                                                        <span th:if="${m?.meta?.state eq 3}"
                                                            th:title="${m?.meta?.errorMessage}"
                                                            class="mapping-error-sign" data-toggle="tooltip"
                                                            data-placement="top"><i
                                                                class="fa fa-exclamation-triangle"></i></span>
                                                    </td>

                                                    <!-- 起始源 -->
                                                    <td>
                                                        <div class="dbsyncer_over_hidden"
                                                            style="display: flex; align-items: center;">
                                                            <img draggable="false"
                                                                th:src="@{'/img/'+ ${m?.sourceConnector?.config?.connectorType} + '.png'}"
                                                                style="width: 20px; height: 20px; margin-right: 5px;">
                                                            <span th:text="${m?.sourceConnector?.name}"
                                                                th:title="${m?.sourceConnector?.name}"></span>
                                                            <span th:if="${m?.sourceConnector?.running}" th:title="连接正常"
                                                                style="margin-left: 5px;"><i
                                                                    class="fa fa-circle well-sign-green"></i></span>
                                                            <span th:unless="${m?.sourceConnector?.running}"
                                                                th:title="连接异常" style="margin-left: 5px;"><i
                                                                    class="fa fa-times-circle-o well-sign-red"></i></span>
                                                        </div>
                                                    </td>

                                                    <!-- 目标源 -->
                                                    <td>
                                                        <div class="dbsyncer_over_hidden"
                                                            style="display: flex; align-items: center;">
                                                            <img draggable="false"
                                                                th:src="@{'/img/'+ ${m?.targetConnector?.config?.connectorType} + '.png'}"
                                                                style="width: 20px; height: 20px; margin-right: 5px;">
                                                            <span th:text="${m?.targetConnector?.name}"
                                                                th:title="${m?.targetConnector?.name}"></span>
                                                            <span th:if="${m?.targetConnector?.running}" th:title="连接正常"
                                                                style="margin-left: 5px;"><i
                                                                    class="fa fa-circle well-sign-green"></i></span>
                                                            <span th:unless="${m?.targetConnector?.running}"
                                                                th:title="连接异常" style="margin-left: 5px;"><i
                                                                    class="fa fa-times-circle-o well-sign-red"></i></span>
                                                        </div>
                                                    </td>

                                                    <!-- 同步类型 -->
                                                    <td th:text="${m?.meta?.model}"></td>

                                                    <!-- 总数 -->
                                                    <td>
                                                        <span th:text="${m?.meta?.total}"></span>
                                                        <span th:if="${m?.meta?.syncPhase.code eq 0}">
                                                            <span th:if="${m?.meta?.counting}">(统计中)</span>
                                                            <span
                                                                th:if="${m?.meta?.total gt 0 and (m?.meta?.success + m?.meta?.fail) gt 0}">,
                                                                进度:[[${#numbers.formatPercent(((m?.meta?.success +
                                                                m?.meta?.fail) / m?.meta?.total), 2, 2)}]]
                                                            </span>
                                                        </span>
                                                        <span th:if="${m?.meta?.success gt 0}"
                                                            style="margin-left: 5px; color: green;">成功:[[${m?.meta?.success}]]</span>
                                                        <span th:if="${m?.meta?.fail gt 0}"
                                                            style="margin-left: 5px; color: red;">失败:[[${m?.meta?.fail}]]</span>
                                                    </td>

                                                    <!-- 耗时 -->
                                                    <td>
                                                        <span
                                                            th:if="${m?.meta?.beginTime gt 0 and m?.meta?.updateTime gt 0}">
                                                            <span
                                                                th:with="seconds=${(m?.meta?.updateTime - m?.meta?.beginTime) / 1000}">
                                                                <span th:if="${seconds lt 60}"
                                                                    th:text="${seconds + '秒'}" />
                                                                <span th:if="${seconds ge 60}"
                                                                    th:with="minutes=${seconds / 60}"
                                                                    th:text="${minutes + '分' + (seconds - minutes * 60) + '秒'}" />
                                                            </span>
                                                        </span>
                                                        <span
                                                            th:unless="${m?.meta?.beginTime gt 0 and m?.meta?.updateTime gt 0}">-</span>
                                                    </td>

                                                    <!-- 启动时间 -->
                                                    <td>
                                                        <span
                                                            th:if="${m?.meta?.beginTime gt 0}">[[${#dates.format(m?.meta?.beginTime,
                                                            'yyyy-MM-dd HH:mm:ss')}]]</span>
                                                        <span th:unless="${m?.meta?.beginTime gt 0}">-</span>
                                                    </td>

                                                    <!-- 创建时间 -->
                                                    <td
                                                        th:text="${#dates.format(m?.updateTime, 'yyyy-MM-dd HH:mm:ss')}">
                                                    </td>

                                                    <!-- 操作 -->
                                                    <td>
                                                        <div class="operation-buttons">
                                                            <!-- 未运行 -->
                                                            <a th:if="${m?.meta?.state ne 1}"
                                                                th:attr="data-url='/mapping/start?id='+${m?.id}"
                                                                href="javascript:;"
                                                                class="btn btn-xs btn-primary margin-right-5"><i
                                                                    class="fa fa-check-circle-o"></i> 启动</a>
                                                            <!-- 运行中 -->
                                                            <a th:if="${m?.meta?.state eq 1}"
                                                                th:attr="data-url='/mapping/stop?id='+${m?.id}"
                                                                href="javascript:;"
                                                                class="btn btn-xs btn-warning margin-right-5"><i
                                                                    class="fa fa-times-circle-o"></i> 停止</a>
                                                            <a th:attr="data-url='/mapping/copy?id='+${m?.id}"
                                                                href="javascript:;"
                                                                class="btn btn-xs btn-info margin-right-5"><i
                                                                    class="fa fa-copy"></i> 复制</a>
                                                            <a href="javascript:;"
                                                                th:attr="data-url='/mapping/page/edit?classOn=0&id='+${m?.id}"
                                                                class="btn btn-xs btn-primary margin-right-5"><i
                                                                    class="fa fa-pencil"></i> 编辑</a>
                                                            <!-- 未运行 -->
                                                            <a th:if="${m?.meta?.state ne 1}"
                                                                th:attr="data-url='/mapping/remove?id='+${m?.id}"
                                                                href="javascript:;" confirm="true"
                                                                confirmMessage="确认删除驱动?"
                                                                class="btn btn-xs btn-danger margin-right-5"><i
                                                                    class="fa fa-trash"></i> 删除</a>
                                                            <!-- 重置 -->
                                                            <a th:attr="data-url='/mapping/reset?id='+${m?.id}"
                                                                href="javascript:;" confirm="true"
                                                                confirmMessage="确认重置驱动?"
                                                                class="btn btn-xs btn-default margin-right-5"><i
                                                                    class="fa fa-refresh"></i> 重置</a>
                                                            <!-- 日志 -->
                                                            <a th:if="${m?.meta?.fail gt 0}" th:attr="id=${m?.meta?.id}"
                                                                href="javascript:;"
                                                                class="btn btn-xs btn-default queryData"><i
                                                                    class="fa fa-file-text-o"></i> 日志</a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 驱动结束位置 -->
                </div>
            </div>

        </form>
    </div>
</div>

<script th:src="@{/js/index/index.js}"></script>

</html>