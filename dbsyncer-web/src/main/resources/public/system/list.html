<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" lang="zh-CN">

<div class="form-container">
    <div class="card-header">
        <h3 class="card-title text-center">系统配置</h3>
    </div>
    <div class="card-body">
        <form id="config-form-edit">
            <!-- 管理员操作区域 -->
            <div class="form-actions mb-4">
                <button id="updateSystemBtn" class="btn btn-primary">
                    <span class="fa fa-save"></span> 保存
                </button>
            </div>
            <div class="grid grid-cols-2">
                <div class="form-item">
                    <label class="form-label">记录同步成功数据</label>
                    <div class="form-control-area">
                        <label class="form-switch">
                            <input name="enableStorageWriteSuccess" th:checked="${config?.enableStorageWriteSuccess}" type="checkbox" />
                            <span class="switch-track">
                                <span class="switch-option switch-option-on">Yes</span>
                                <span class="switch-option switch-option-off">No</span>
                                <span class="switch-thumb"></span>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">记录全量数据<i class="fa fa-question-circle" title="不推荐在生产环境下开启，可在源库数据量较少时使用，一般用于测试"></i></label>
                    <div class="form-control-area">
                        <label class="form-switch">
                            <input name="enableStorageWriteFull" th:checked="${config?.enableStorageWriteFull}" type="checkbox" />
                            <span class="switch-track">
                                <span class="switch-option switch-option-on">Yes</span>
                                <span class="switch-option switch-option-off">No</span>
                                <span class="switch-thumb"></span>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">记录同步失败数据</label>
                    <div class="form-control-area">
                        <label class="form-switch">
                            <input name="enableStorageWriteFail" th:checked="${config?.enableStorageWriteFail}" type="checkbox" />
                            <span class="switch-track">
                                <span class="switch-option switch-option-on">Yes</span>
                                <span class="switch-option switch-option-off">No</span>
                                <span class="switch-thumb"></span>
                            </span>
                        </label>
                    </div>
                </div>
                <div id="maxStorageErrorLength" class="form-item hidden">
                    <label class="form-label">记录失败日志长度<strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input type="number" class="form-control" min="1024" max="8192" required name="maxStorageErrorLength" th:value="${config?.maxStorageErrorLength}"/>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">刷新监控频率(秒)<strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input type="number" class="form-control" min="1" max="60" required name="refreshIntervalSeconds" th:value="${config?.refreshIntervalSeconds}"/>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">表执行器上限数<i class="fa fa-question-circle" title="每新增一张驱动表的映射关系，就会单独新开一个表执行器处理，超过此限制后，则使用通用执行器"></i><strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input type="number" class="form-control" min="1" max="200" required name="maxBufferActuatorSize" th:value="${config?.maxBufferActuatorSize}"/>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">同步数据过期时间(天)<strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input type="number" class="form-control" min="1" max="180" required name="expireDataDays" th:value="${config?.expireDataDays}"/>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">系统日志过期时间(天)<strong class="text-primary">*</strong></label>
                    <div class="form-control-area">
                        <input type="number" class="form-control" min="1" max="180" required name="expireLogDays" th:value="${config?.expireLogDays}"/>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">水印<i class="fa fa-question-circle" title="刷新页面生效"></i></label>
                    <div class="form-control-area">
                        <label class="form-switch">
                            <input id="enableWatermark" name="enableWatermark" th:checked="${config?.enableWatermark}" type="checkbox" />
                            <span class="switch-track">
                                <span class="switch-option switch-option-on">Yes</span>
                                <span class="switch-option switch-option-off">No</span>
                                <span class="switch-thumb"></span>
                            </span>
                        </label>
                    </div>
                </div>
                <div id="watermark" class="form-item">
                    <label class="form-label">水印内容</label>
                    <div class="form-control-area">
                        <input type="text" class="form-control" maxlength="64" name="watermark" placeholder="请输入水印(最多64个字)." th:value="${config?.watermark}"/>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">标准数据解析器<i class="fa fa-question-circle" title="开启可以支持更多异构字段类型转换，主要用于兼容异构数据库同步"></i></label>
                    <div class="form-control-area">
                        <label class="form-switch">
                            <input name="enableSchemaResolver" th:checked="${config?.enableSchemaResolver}" type="checkbox" />
                            <span class="switch-track">
                                <span class="switch-option switch-option-on">Yes</span>
                                <span class="switch-option switch-option-off">No</span>
                                <span class="switch-thumb"></span>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">打印trace信息<i class="fa fa-question-circle" title="仅用于排查问题，生产环境建议关闭"></i></label>
                    <div class="form-control-area">
                        <label class="form-switch">
                            <input name="enablePrintTraceInfo" th:checked="${config?.enablePrintTraceInfo}" type="checkbox" />
                            <span class="switch-track">
                                <span class="switch-option switch-option-on">Yes</span>
                                <span class="switch-option switch-option-off">No</span>
                                <span class="switch-thumb"></span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    $(function () {
        $('.dbsyncer_switch').each(function () {
            const $input = $(this);
            $input.attr('role', 'switch');
            $input.attr('aria-checked', $input.is(':checked'));
            $input.on('change', function () {
                $input.attr('aria-checked', this.checked);
            });
        });
        //保存
        $("#updateSystemBtn").click(function () {
            const $form = $("#config-form-edit");
            if (validateForm($form)) {
                const submitBtn = $(this);
                const originalText = submitBtn.html();
                submitBtn.html('<i class="fa fa-spinner fa-spin"></i> 保存中...').prop('disabled', true);
                doPoster('/system/edit', $form.serializeJson(), function (data) {
                    submitBtn.html(originalText).prop('disabled', false);
                    if (data.success === true) {
                        bootGrowl("修改成功!", "success");
                        doLoader("/system");
                    } else {
                        bootGrowl(data.resultValue, "danger");
                    }
                });
            }
        });
    })
</script>
</html>